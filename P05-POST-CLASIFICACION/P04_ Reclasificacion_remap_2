/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var C15_to_c10 = /* color: #9b08d6 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.5848465282449, -12.949404203129783],
                  [-72.57999709434597, -12.947982185268666],
                  [-72.57995417900173, -12.945430897591718],
                  [-72.58325866050808, -12.944427105117557],
                  [-72.58501818962185, -12.94697840306945]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.56314392087066, -12.934731379151916],
                  [-72.57018203732574, -12.936739038120365],
                  [-72.57498855588042, -12.945940601594945],
                  [-72.57207031247222, -12.946860739263473],
                  [-72.57207031247222, -12.956145574694114],
                  [-72.56872291562163, -12.961666123572419],
                  [-72.55842323300445, -12.965430063982394],
                  [-72.54305953976714, -12.966015560707874],
                  [-72.54134292599761, -12.960996972651982],
                  [-72.52512092587554, -12.967939325963512],
                  [-72.52065773007476, -12.965430063982394],
                  [-72.51473541256988, -12.950290313371005],
                  [-72.53610725400054, -12.939164937813784],
                  [-72.54932518002593, -12.930799666872028],
                  [-72.55962486264312, -12.930548704410361],
                  [-72.55885238644683, -12.93531694802016],
                  [-72.55816574093902, -12.937324602275687],
                  [-72.55790824887359, -12.939332240371122],
                  [-72.56048316952788, -12.94100525977113],
                  [-72.56194229123199, -12.941507163402282],
                  [-72.56331558224761, -12.94100525977113]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.51130218503081, -12.944685862936376],
                  [-72.51224632260406, -12.958403995847501],
                  [-72.50117416379058, -12.969277588673165],
                  [-72.48469467160308, -12.970281280981242],
                  [-72.47945899960601, -12.966935624207494],
                  [-72.47190589902007, -12.974212370193712],
                  [-72.46134872433745, -12.97814339726668],
                  [-72.45774383542144, -12.975299681771839],
                  [-72.45362396237456, -12.973794172167022],
                  [-72.44795913693511, -12.971954092495464],
                  [-72.45036239621245, -12.96635012964679],
                  [-72.46928676458357, -12.938769491996023],
                  [-72.49640926214217, -12.938267582854737]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.4600767117461, -13.098549723113154],
                  [-72.45720138368213, -13.09633437886272],
                  [-72.45424022492969, -13.088935820662954],
                  [-72.46372451600635, -13.08927022356763],
                  [-72.46411075934635, -13.091527430155384],
                  [-72.46166457948291, -13.091778230887325],
                  [-72.4606346112212, -13.091820030793032],
                  [-72.45990505036914, -13.09211262993442],
                  [-72.46016254243457, -13.09269782717467],
                  [-72.46136417207325, -13.092739626924352],
                  [-72.46183624085987, -13.094955003508012],
                  [-72.46084918794239, -13.09658517355177]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.37714299510547, -13.133315403291382],
                  [-72.377958386646, -13.132897474425151],
                  [-72.3785162861211, -13.133440781812553],
                  [-72.37860211680957, -13.134736356116145],
                  [-72.37671384166309, -13.135154281852635]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.37020350639469, -13.128086835411642],
                  [-72.37011767570621, -13.122528205017659],
                  [-72.37273551170475, -13.121650515040688],
                  [-72.37445212547428, -13.122778973006831],
                  [-72.37569667045719, -13.129257057364903],
                  [-72.37316466514713, -13.131221345967981],
                  [-72.37140513603336, -13.132851275648674]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.40372039024479, -13.153788640545176],
                  [-72.4044070357526, -13.151699163438435],
                  [-72.40955687706119, -13.152618535559116],
                  [-72.40938521568424, -13.154958739946792],
                  [-72.40668154986047, -13.156296001951478],
                  [-72.40432120506412, -13.155125896548272]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.42019988243229, -13.143842570206788],
                  [-72.42801047508365, -13.137824583958738],
                  [-72.43170119468815, -13.138911175725257],
                  [-72.43530608360416, -13.144009734384818],
                  [-72.42723799888736, -13.146851507985268],
                  [-72.42071486656315, -13.147520155813082]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.40998603156731, -13.102256927821822],
                  [-72.4117026442731, -13.097617310487534],
                  [-72.41513587181217, -13.094440572202869],
                  [-72.41676665489322, -13.09410617631577],
                  [-72.41762496177799, -13.097617310487534],
                  [-72.41513587181217, -13.101964359626493],
                  [-72.41153098289615, -13.103719876944036]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.48483039085514, -13.121859489129],
                  [-72.48191214744693, -13.119518969191713],
                  [-72.48010970298893, -13.11634251363509],
                  [-72.48156882469303, -13.114921454442872],
                  [-72.48448706810123, -13.114837862469946],
                  [-72.48757697288639, -13.117596382572977],
                  [-72.48895026390201, -13.120605641934059],
                  [-72.48817778770572, -13.121775899515004],
                  [-72.48371459190494, -13.121859489129]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.50096656028873, -13.101797166848074],
                  [-72.49950743858463, -13.099958038791481],
                  [-72.49736167137272, -13.097951701607515],
                  [-72.49770499412662, -13.095945348076912],
                  [-72.50251151268131, -13.095945348076912],
                  [-72.50560141746647, -13.09786810387009],
                  [-72.50422812645084, -13.100961201252762],
                  [-72.5018248671735, -13.103719876944036]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.35994489441235, -13.222496890656302],
                  [-72.35801370392163, -13.222413335396555],
                  [-72.35513837585766, -13.221703114532799],
                  [-72.35513837585766, -13.22107644734705],
                  [-72.35634000549634, -13.219614217651582],
                  [-72.35801370392163, -13.218235535909557],
                  [-72.35973031769116, -13.217734195162297],
                  [-72.3608890319856, -13.218026644056748],
                  [-72.36191900024731, -13.219906664291988],
                  [-72.36170442352612, -13.2219537809562],
                  [-72.35934407959301, -13.222496890656302]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.34771402130444, -13.230935824388297],
                  [-72.34634073028882, -13.231646018353365],
                  [-72.34466703186352, -13.231228257448102],
                  [-72.34192044983227, -13.228679900417712],
                  [-72.34144838104565, -13.226382178613358],
                  [-72.34256417999585, -13.225087089507099],
                  [-72.34505326996167, -13.223123554191806],
                  [-72.3478856826814, -13.22320710920819],
                  [-72.34835775146801, -13.224251544497177],
                  [-72.34719903717358, -13.22563019222798],
                  [-72.34775693664868, -13.227844367722174],
                  [-72.34749944458325, -13.229766088639852]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.3342208958465, -13.241803833078],
                  [-72.33156014450373, -13.242513995356436],
                  [-72.32512284286798, -13.241803833078],
                  [-72.32529450424494, -13.238837838820013],
                  [-72.32825566299738, -13.235913583766132],
                  [-72.33040143020929, -13.235078075874009],
                  [-72.3338775730926, -13.235704707061759],
                  [-72.33392048843683, -13.237918791014817],
                  [-72.3338775730926, -13.241970930271043]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.31389625716416, -13.286486934287135],
                  [-72.31363876509873, -13.284147991532095],
                  [-72.31183632064072, -13.284064457445327],
                  [-72.31037719893662, -13.285233932043516],
                  [-72.30917556929795, -13.287155199504628],
                  [-72.30651481795518, -13.287322265521404],
                  [-72.30874641585557, -13.288825854495414],
                  [-72.30557068038193, -13.289410581024132],
                  [-72.30222328353135, -13.289410581024132],
                  [-72.30067833113877, -13.289410581024132],
                  [-72.29930504012314, -13.289661177676404],
                  [-72.29818924117295, -13.288742322019115],
                  [-72.2969017808458, -13.287656397209837],
                  [-72.29570015120713, -13.287071666453093],
                  [-72.29561432051865, -13.28849172441764],
                  [-72.29492767501084, -13.290496497980886],
                  [-72.29535682845322, -13.292167129959697],
                  [-72.29621513533799, -13.29392128115196],
                  [-72.29527099776475, -13.296009539835921],
                  [-72.29355438399521, -13.296176599753679],
                  [-72.29329689192978, -13.297346015954746],
                  [-72.29115112471787, -13.298682484705788],
                  [-72.2910652940294, -13.300603645626015],
                  [-72.288833696129, -13.302190680117723],
                  [-72.28694542098252, -13.302942429670512],
                  [-72.28582962203232, -13.3039447587798],
                  [-72.28582962203232, -13.305281191142383],
                  [-72.2873745744249, -13.306367037008895],
                  [-72.29149444747178, -13.308538714140711],
                  [-72.2939835374376, -13.310376271890629],
                  [-72.29509933638779, -13.311796193329942],
                  [-72.29664428878037, -13.312547913074217],
                  [-72.29776008773057, -13.311629144180971],
                  [-72.29673011946885, -13.309958646353504],
                  [-72.29587181258408, -13.307536404037604],
                  [-72.29784591841904, -13.306534089787144],
                  [-72.29930504012314, -13.307870507866124],
                  [-72.3038540666124, -13.310376271890629],
                  [-72.30290992903916, -13.313132582373026],
                  [-72.30102165389268, -13.313132582373026],
                  [-72.2983609025499, -13.312965534145999],
                  [-72.29698761153428, -13.313633726362625],
                  [-72.29767425704209, -13.315387722157485],
                  [-72.2983609025499, -13.318478064779653],
                  [-72.28797538924424, -13.316974659783519],
                  [-72.28222473311631, -13.312130291282156],
                  [-72.28239639449326, -13.298682484705788],
                  [-72.28977783370225, -13.286319867695163],
                  [-72.29509933638779, -13.27980418089601],
                  [-72.30007751631943, -13.277465173742014],
                  [-72.31381042647568, -13.274791995118223],
                  [-72.3148403947374, -13.278216999927572],
                  [-72.31544120955674, -13.287238732527399]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.31707199263779, -13.29960130269788],
                  [-72.31707199263779, -13.298181309787598],
                  [-72.31750114608018, -13.295675419655092],
                  [-72.3188744370958, -13.295007177912115],
                  [-72.32110603499619, -13.296427189414478],
                  [-72.32110603499619, -13.299684831433543],
                  [-72.31973274398057, -13.301021287289318]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.32419593978135, -13.303861231512398],
                  [-72.32239349532334, -13.30452944884547],
                  [-72.32093437361924, -13.30419534040928],
                  [-72.32222183394639, -13.302524791317976],
                  [-72.32411010909287, -13.303109484809982]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.365737993004, -13.312798485803718],
                  [-72.36410720992295, -13.313299630484805],
                  [-72.36290558028428, -13.311378570241448],
                  [-72.3631630723497, -13.309541020096225],
                  [-72.36496551680771, -13.30920691857193],
                  [-72.36651046920029, -13.311879717861203]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.40532361916202, -13.316778942062225],
                  [-72.40223371437686, -13.319618701511477],
                  [-72.39931547096866, -13.31728007850369],
                  [-72.39777051857608, -13.315860189224942],
                  [-72.40163289955753, -13.311433422138386],
                  [-72.40506612709659, -13.311433422138386],
                  [-72.40592443398135, -13.312936861545642],
                  [-72.40609609535831, -13.315442573146186]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.41630994728702, -13.298653810414981],
                  [-72.42214643410342, -13.30057497156249],
                  [-72.42171728066104, -13.303080811042948],
                  [-72.41648160866397, -13.30257964521972]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.47191137613744, -13.3619153735249],
                  [-72.47105306925268, -13.36325148544927],
                  [-72.468048995156, -13.366758744033456],
                  [-72.46349996866674, -13.367760808545235],
                  [-72.4530286246726, -13.368762868892311],
                  [-72.44968122782201, -13.36884637373324],
                  [-72.4464196616599, -13.365422651539792],
                  [-72.44624800028295, -13.357823484720505],
                  [-72.44976705851049, -13.357322432342636],
                  [-72.45697683634252, -13.360412238763612],
                  [-72.46538824381322, -13.362082387920216],
                  [-72.47079557718725, -13.360245223211987]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.50598615946264, -13.349054917923395],
                  [-72.5024671012351, -13.349806521843828],
                  [-72.50109381021947, -13.34913842958565],
                  [-72.49748892130346, -13.348136287732293],
                  [-72.49508566202611, -13.344879297986983],
                  [-72.49688810648412, -13.344545245273212],
                  [-72.50255293192357, -13.345380376191363],
                  [-72.50547117533178, -13.347468190852794]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.53381069890085, -13.353412466172147],
                  [-72.53604229680124, -13.354832134875322],
                  [-72.53818806401316, -13.358172498881395],
                  [-72.53578480473581, -13.36184684587609],
                  [-72.53501232853952, -13.366272689533186],
                  [-72.52977665654245, -13.368861352889725],
                  [-72.5244551538569, -13.369278876634535],
                  [-72.52093609562937, -13.371951011477094],
                  [-72.51664456120554, -13.37261904055914],
                  [-72.50831898442331, -13.373537577523617],
                  [-72.50351246586862, -13.37036443498683],
                  [-72.5050574182612, -13.366272689533186],
                  [-72.50660237065378, -13.36184684587609],
                  [-72.51106556645456, -13.354331076286531],
                  [-72.51621540776316, -13.352076299764974],
                  [-72.52067860356394, -13.355166173356594],
                  [-72.52428349247995, -13.358590041130864],
                  [-72.52797421208444, -13.359675647597735],
                  [-72.52934750310007, -13.359425123462033],
                  [-72.53011997929636, -13.358590041130864],
                  [-72.5307207941157, -13.357253903389191]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.37730659847816, -13.023900865974602],
                  [-72.3782507360514, -13.023900865974602],
                  [-72.37962402706702, -13.023315505738749],
                  [-72.38022484188636, -13.022228404488159],
                  [-72.38039650326331, -13.021392169510792],
                  [-72.38537468319495, -13.020472307775687],
                  [-72.39249863033851, -13.019217945360646],
                  [-72.39799179440101, -13.021475793135542],
                  [-72.39970840817054, -13.026158671068872],
                  [-72.39704765682777, -13.030674219504323],
                  [-72.3895803869303, -13.034604352032256],
                  [-72.38194145565589, -13.034687971195284],
                  [-72.37207092648109, -13.026660402739127],
                  [-72.36632027035316, -13.022646520918327],
                  [-72.36571945553382, -13.016374700379405],
                  [-72.36735023861488, -13.014284058260571],
                  [-72.37215675716956, -13.015705696819882],
                  [-72.37756409054359, -13.020472307775687],
                  [-72.37696327572425, -13.021726663840447],
                  [-72.37670578365882, -13.022981013554363]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.42520012264808, -12.998980021208403],
                  [-72.42211021786292, -12.995802015370549],
                  [-72.41970695858558, -12.99003132182603],
                  [-72.42133774166663, -12.987187742358426],
                  [-72.4233118475016, -12.98869317083738],
                  [-72.42691673641761, -12.99596927985003]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.40704693203529, -13.025447882796046],
                  [-72.40987934475501, -13.02319007122254],
                  [-72.41623081570228, -13.024360790903767],
                  [-72.43073620205482, -13.028458266210022],
                  [-72.43090786343177, -13.03197033393606],
                  [-72.42000736599525, -13.031384992774923],
                  [-72.4066177785929, -13.027872916745613]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.52442876858063, -13.243836173914302],
                  [-72.53198186916657, -13.243167789574704],
                  [-72.53455678982087, -13.247595801629593],
                  [-72.53412763637849, -13.265223503396179],
                  [-72.5333551601822, -13.268982800508079],
                  [-72.52108137173005, -13.270235886620585],
                  [-72.51155416530915, -13.266727229219763],
                  [-72.50975172085114, -13.258874336246093],
                  [-72.51412908596345, -13.248598359212234]]]),
            {
              "original": "15,",
              "new": "10,",
              "t0": 1,
              "t1": 12,
              "system:index": "26"
            })]),
    c10_to_c15 = /* color: #193fff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.44765743108748, -12.989291741092066],
                  [-72.44662746282576, -12.989291741092066],
                  [-72.44516834112166, -12.98878993382199],
                  [-72.44491084905623, -12.987953586119108],
                  [-72.44525417181013, -12.98644815315827],
                  [-72.44671329351424, -12.986029975716868],
                  [-72.44774326177595, -12.986364517726294],
                  [-72.44851573797224, -12.988371760322527]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.43426784368513, -12.992302563421852],
                  [-72.43392452093123, -12.990880790758995],
                  [-72.43486865850447, -12.990378986699357],
                  [-72.43504031988142, -12.992135296472236]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.435684050045, -12.984691803174604],
                  [-72.43499740453719, -12.984273622777167],
                  [-72.43435367437361, -12.983939077952517],
                  [-72.43405326696394, -12.983562714486414],
                  [-72.43516906591414, -12.983269986952028],
                  [-72.435684050045, -12.9840227142009],
                  [-72.43619903417586, -12.984273622777167]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.43933405297048, -13.000827270480318],
                  [-72.43896927254445, -13.000785455189453],
                  [-72.43828262703664, -13.000325486524785],
                  [-72.43806805031545, -13.000032778748844],
                  [-72.43817533867605, -12.999342823339603],
                  [-72.43860449211843, -12.998778312941756],
                  [-72.43899073021657, -12.999071022197215],
                  [-72.4393555106426, -12.999844609282016],
                  [-72.4393555106426, -13.000576378629379]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.47276060060699, -13.104569792065975],
                  [-72.47273914293487, -13.104799679517562],
                  [-72.47258893923004, -13.105134060882019],
                  [-72.47215978578765, -13.105301251393898],
                  [-72.47192375139434, -13.10515495970222],
                  [-72.47138730959136, -13.104778780667196],
                  [-72.47100107149322, -13.104256308831399],
                  [-72.47076503709991, -13.103838330564217],
                  [-72.47067920641143, -13.103420351587253],
                  [-72.47091524080474, -13.10329495775576],
                  [-72.47149459795196, -13.102897876867939],
                  [-72.47179500536163, -13.102897876867939],
                  [-72.47211687044341, -13.102897876867939],
                  [-72.47230998949249, -13.103211361832608],
                  [-72.47252456621368, -13.103712936945655],
                  [-72.47267476991851, -13.104277207726124]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.47414805740098, -13.113173834092565],
                  [-72.4746201261876, -13.112755870973908],
                  [-72.47526385635118, -13.112797667317729],
                  [-72.47543551772813, -13.11325742663107],
                  [-72.47513511031846, -13.113550000292106],
                  [-72.47474887222032, -13.11338281538556],
                  [-72.47431971877793, -13.113550000292106]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.4705860838292, -13.110039093391517],
                  [-72.47019984573106, -13.109746515554631],
                  [-72.47015693038682, -13.109161358837051],
                  [-72.4708006605504, -13.108826982945018],
                  [-72.47208812087754, -13.108785185926555],
                  [-72.47277476638536, -13.108826982945018],
                  [-72.47328975051622, -13.108994170947833],
                  [-72.4731610044835, -13.109537531172402],
                  [-72.4726031050084, -13.109913702932609],
                  [-72.47101523727159, -13.110289874117615]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.47067191451768, -13.113550000292106],
                  [-72.4702427610753, -13.11367538889744],
                  [-72.46959903091172, -13.113466407853037],
                  [-72.46959903091172, -13.113132037812665],
                  [-72.47028567641954, -13.112923056306597],
                  [-72.4708006605504, -13.113173834092565]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.45365408492331, -13.120602884401126],
                  [-72.45301035475974, -13.120101343726708],
                  [-72.45228079390769, -13.119934163274504],
                  [-72.4520662171865, -13.119265440328755],
                  [-72.45180872512107, -13.1187638969257],
                  [-72.45223787856345, -13.118638510915074],
                  [-72.45258120131736, -13.119181849832637],
                  [-72.45322493148093, -13.119265440328755],
                  [-72.45399740767722, -13.119725187549374],
                  [-72.45446947646384, -13.120519294359791]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.4030378239905, -13.164443624630234],
                  [-72.4029305356299, -13.164527199710394],
                  [-72.40282324726931, -13.164642115399053],
                  [-72.40265158589236, -13.164600327882129],
                  [-72.40259794171206, -13.164495859058668],
                  [-72.40261939938418, -13.164401837079456],
                  [-72.40283397610537, -13.164161558524205],
                  [-72.40296272213808, -13.16419289921869],
                  [-72.40304855282656, -13.164360049521564]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.4800846470822, -13.100981993906021],
                  [-72.47982715501676, -13.100877498015839],
                  [-72.47963403596769, -13.100731203695078],
                  [-72.47967695131193, -13.1004595140116],
                  [-72.47978423967253, -13.100208723268436],
                  [-72.48012756242643, -13.100292320211219],
                  [-72.48027776613127, -13.100564010079195],
                  [-72.48027776613127, -13.10085659883248]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.36736877608506, -13.300979523155373],
                  [-72.36700399565903, -13.301668630445125],
                  [-72.36668213057725, -13.302190680117723],
                  [-72.36614568877427, -13.302691846745363],
                  [-72.36593111205308, -13.302190680117723],
                  [-72.36623151946274, -13.301605984408846],
                  [-72.36623151946274, -13.301000405223247],
                  [-72.36638172316758, -13.30014423896517],
                  [-72.36681087660996, -13.299246305250168],
                  [-72.36700399565903, -13.298536308795015],
                  [-72.36711128401963, -13.298181309787598],
                  [-72.36747606444565, -13.298139545164318],
                  [-72.36756189513413, -13.298473661949133],
                  [-72.3674116914293, -13.299016600742242],
                  [-72.36726148772446, -13.299663949252324],
                  [-72.36745460677353, -13.300102474680099],
                  [-72.36745460677353, -13.300687174016257]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.39247425246445, -13.296051304826149],
                  [-72.39213092971055, -13.296218364715129],
                  [-72.39183052230088, -13.295675419655092],
                  [-72.39135845351426, -13.295048943075006],
                  [-72.39127262282578, -13.294505995396305],
                  [-72.39114387679307, -13.293712454294424],
                  [-72.39127262282578, -13.293127738136652],
                  [-72.39183052230088, -13.292918910595768],
                  [-72.39281757521836, -13.293294800039877],
                  [-72.39324672866074, -13.293503627257058],
                  [-72.39324672866074, -13.29421363845038],
                  [-72.39298923659531, -13.294965412742034],
                  [-72.39281757521836, -13.295758949743455]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.37934474872856, -13.278509440978713],
                  [-72.3797309868267, -13.278258832810721],
                  [-72.38033180164604, -13.278300600856683],
                  [-72.38033180164604, -13.278676512946992],
                  [-72.38003139423637, -13.279261263930563],
                  [-72.37951641010551, -13.279052424455257]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.38597456365406, -13.29539750221791],
                  [-72.38586191087543, -13.295470591130591],
                  [-72.38575998693287, -13.295517576848523],
                  [-72.38558296113789, -13.295449708586359],
                  [-72.38545421510517, -13.295366178391445],
                  [-72.38538984208881, -13.295240883045125],
                  [-72.38535765558063, -13.295000733450362],
                  [-72.38537911325275, -13.294922423748465],
                  [-72.38554004579365, -13.294854555319702],
                  [-72.38574389367878, -13.294880658563779],
                  [-72.38590482621967, -13.294979850865658],
                  [-72.38606039434254, -13.29512080827747],
                  [-72.38602820783436, -13.295324413283192]]]),
            {
              "original": "10,",
              "new": "15,",
              "t0": 1,
              "t1": 12,
              "system:index": "14"
            })]),
    C5_to_C3 = /* color: #ffbe04 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.54860424703172, -13.144983768506112],
                  [-72.5485827893596, -13.145140484197418],
                  [-72.54833602613023, -13.145150931906624],
                  [-72.54830383962205, -13.145234513564157],
                  [-72.54817509358934, -13.145328542894854],
                  [-72.5476279229503, -13.145412124491894],
                  [-72.54747771924546, -13.145234513564157],
                  [-72.54700565045884, -13.145224065858528],
                  [-72.54669451421312, -13.144900186763145],
                  [-72.546673056541, -13.144649441363406],
                  [-72.546673056541, -13.144398695707402],
                  [-72.54658722585252, -13.144210636297231],
                  [-72.54693054860643, -13.144095711031174],
                  [-72.54722022718003, -13.14433600925337],
                  [-72.54754209226182, -13.1441792930482],
                  [-72.54771375363877, -13.14443003892842],
                  [-72.54786395734361, -13.144670336823173],
                  [-72.54815363591722, -13.14485839588099],
                  [-72.54831456845811, -13.144921082201554]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.5481858224254, -13.147438969501684],
                  [-72.54833602613023, -13.147438969501684],
                  [-72.5484218568187, -13.14735538859523],
                  [-72.54856133168748, -13.147438969501684],
                  [-72.54862570470384, -13.147710607251016],
                  [-72.54841112798265, -13.14779418803644],
                  [-72.54808926290086, -13.147867321200321],
                  [-72.54778885549119, -13.147595683624559],
                  [-72.54754209226182, -13.147574788413957],
                  [-72.54747771924546, -13.147449417113002],
                  [-72.54781031316331, -13.147334493364172],
                  [-72.54792833035997, -13.14717777907443],
                  [-72.54808926290086, -13.14724046480234]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.55174568406495, -13.164400243725373],
                  [-72.55175104848298, -13.164217423105757],
                  [-72.55180469266328, -13.164008485087683],
                  [-72.55189588776979, -13.163804770348497],
                  [-72.55195489636812, -13.163731641939254],
                  [-72.55208900681886, -13.16392490983057],
                  [-72.55216947308931, -13.164092060316298],
                  [-72.55231431237611, -13.164107730668485],
                  [-72.55231431237611, -13.16424354034547],
                  [-72.55204072705659, -13.16424354034547],
                  [-72.55204072705659, -13.164395020280994],
                  [-72.55190661660585, -13.164462925049271]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.5537609855832, -13.16716231979688],
                  [-72.55401847764863, -13.167715998025928],
                  [-72.55382535859955, -13.167851805702254],
                  [-72.55401847764863, -13.168102527368392],
                  [-72.554265240878, -13.168144314287792],
                  [-72.554265240878, -13.168405482372501],
                  [-72.5541043083371, -13.16846816267137],
                  [-72.55398629114045, -13.168520396241524],
                  [-72.55392191812409, -13.168729330410711],
                  [-72.5537609855832, -13.16866665017867],
                  [-72.55351422235383, -13.168520396241524],
                  [-72.55329964563263, -13.168353248777832],
                  [-72.55311725541962, -13.168081633906013],
                  [-72.55321381494416, -13.167392148647691],
                  [-72.55333183214081, -13.16716231979688],
                  [-72.55328891679657, -13.167005618184044],
                  [-72.553546408862, -13.166942937510822]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.54786041392845, -13.148335437884663],
                  [-72.547779947658, -13.148379840067363],
                  [-72.54766997708839, -13.148207455077817],
                  [-72.54754927768272, -13.148097755475924],
                  [-72.54753854884666, -13.147933205981108],
                  [-72.54766997708839, -13.147901863207673],
                  [-72.5476726592974, -13.147946265468855],
                  [-72.54769143476051, -13.148016786690686],
                  [-72.54783627404731, -13.14822573834002]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.54798379554313, -13.148257081072073],
                  [-72.5480508507685, -13.148246633495166],
                  [-72.54813399924797, -13.148319766524152],
                  [-72.54820373668235, -13.148405958994601],
                  [-72.54827079190773, -13.14840073520938],
                  [-72.54827347411674, -13.148332825991314],
                  [-72.54823592319053, -13.148230962128983],
                  [-72.54820373668235, -13.148168276654191],
                  [-72.5481769145922, -13.14821529076178],
                  [-72.54810181273979, -13.148230962128983],
                  [-72.54809108390373, -13.148173500444376],
                  [-72.54808303727668, -13.148134322015345],
                  [-72.54800257100624, -13.148074248411996],
                  [-72.54794624461692, -13.148095143580056],
                  [-72.54784968509239, -13.148058577034792],
                  [-72.54785773171943, -13.148001115309807],
                  [-72.54789260043663, -13.147980220133746],
                  [-72.54798111333412, -13.14804029376012],
                  [-72.54802939309639, -13.148019398587392],
                  [-72.54802402867836, -13.147946265468855],
                  [-72.5480320753054, -13.147901863207673],
                  [-72.54795429124397, -13.147854849040023],
                  [-72.54786309613746, -13.147925370288126],
                  [-72.54782018079322, -13.14787052043024],
                  [-72.54779067649406, -13.147752984979174],
                  [-72.54785504951042, -13.147716418382908],
                  [-72.54795160903495, -13.147773880174599],
                  [-72.54807767285865, -13.147894027513695],
                  [-72.54811254157585, -13.147980220133746],
                  [-72.54816618575614, -13.148042905656588],
                  [-72.54823324098152, -13.148082084100222],
                  [-72.54826274528068, -13.148139545806242],
                  [-72.54831907167, -13.148197007498798],
                  [-72.54835394038719, -13.148173500444376],
                  [-72.5484451354937, -13.148147381492379],
                  [-72.54843440665763, -13.148186559919335],
                  [-72.54846927537483, -13.148277976224545],
                  [-72.54859533919853, -13.148361556816633],
                  [-72.5485551060633, -13.148411182779721],
                  [-72.5484826864199, -13.148403347102004],
                  [-72.54845049991172, -13.148364168709676],
                  [-72.54843440665763, -13.148277976224545],
                  [-72.54837003364128, -13.14828581190626],
                  [-72.54834052934211, -13.148345885457788],
                  [-72.54836198701423, -13.148426854134405],
                  [-72.5484102667765, -13.148455584948705],
                  [-72.54841831340354, -13.14847648008426],
                  [-72.54839685573143, -13.14854700115364],
                  [-72.5482654274897, -13.14858356762608],
                  [-72.54816082133812, -13.148507822784264],
                  [-72.5480857194857, -13.148507822784264],
                  [-72.54804816855949, -13.148434689811358],
                  [-72.54797574891609, -13.148372004388653],
                  [-72.54799452437919, -13.148330214097939]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.55063586294446, -13.148250616069586],
                  [-72.55058490097318, -13.148206213863501],
                  [-72.55040519296918, -13.148232332809236],
                  [-72.55019598066602, -13.148261063646313],
                  [-72.5501396542767, -13.148143528382402],
                  [-72.55004577696118, -13.148039052544968],
                  [-72.54996531069074, -13.147986814609565],
                  [-72.55011551439557, -13.14786927921422],
                  [-72.5504078751782, -13.14795285994558],
                  [-72.55059294760022, -13.14803382875192]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.55053930341992, -13.148023381165501],
                  [-72.55069218933377, -13.148062559612265],
                  [-72.55068414270673, -13.148169647334806],
                  [-72.55065732061658, -13.148229720914783],
                  [-72.55061172306333, -13.148206213863501]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-72.55321346580777, -13.148148752173093],
                  [-72.55307667314801, -13.148352479923762],
                  [-72.55298816025052, -13.148396882103372],
                  [-72.55272530376706, -13.148365539389193],
                  [-72.55250536262784, -13.148276735010588],
                  [-72.55230151474271, -13.14821927333672],
                  [-72.55220495521817, -13.14813046890515],
                  [-72.55212448894773, -13.148049500130714],
                  [-72.5519206410626, -13.147976367021148],
                  [-72.55194209873471, -13.147819653141493],
                  [-72.55218081533704, -13.147725624765652],
                  [-72.55228810369763, -13.147678610564212],
                  [-72.55272530376706, -13.147715177166113],
                  [-72.55281918108258, -13.147824876939094],
                  [-72.553073990939, -13.148015545475404],
                  [-72.55318664371762, -13.148099126156929]]]),
            {
              "original": "5,",
              "new": "3,",
              "t0": 1,
              "t1": 12,
              "system:index": "8"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// remap
var param = {
    code_region: 107,  //Region de Clasificacion
    mes: [1,4,6,8,11],  // Solo visualizacion
    version_input:'24', // 
    version_output:'26',// 
    remapGeometry: [
        // C15_to_c10,
        // c10_to_c15,
        // C5_to_C3
      ]
};

var assetClasif = "projects/ee-anp-lineabase/assets/clasificacion";
var assetFiltros = "projects/ee-anp-lineabase/assets/clasificacion-post"
var dirout  = "projects/ee-anp-lineabase/assets/clasificacion-post"
var regionesclass = 'projects/ee-eturpocayo/assets/sernanp/AUXILIAR_DATA/limite_anp_y_za_v2'
var AssetRegionsRaster = 'projects/ee-eturpocayo/assets/sernanp/AUXILIAR_DATA/limite_anp_y_za_v2_raster';

  var version_input = param.version_input;
  var version_output = param.version_output;
  var prefixo_out = 'ANP'+ '-' + param.code_region + '-' 

////*************************************************************
// Do not Change from these lines
////*************************************************************
var cloud_Blue_thr = 10000;
// var palette_0_20 = ["ffffff", "ff0000","b40b0b","ffbd08","5bdd4a","139b01","17ff7e","0f5e00","ffec13",
//                     "ceb747","f8b3ff","d72fff","00ff00","ccebc5","13f5ff","0000ff","3b8aff","d4d4d4", "ff7b06", "fff793", "a0a1af" ];
var palette_0_23 = ["ffffff", "ff0000","b40b0b","ffbd08","5bdd4a","139b01","17ff7e","0f5e00","ffec13",
                    "ceb747","f8b3ff","d72fff","00ff00","ccebc5","13f5ff","0000ff","3b8aff","d4d4d4", "ff7b06", "fff793", "a0a1af", "73ccd6",
                    "b16d04","d2ffa1"];
var vis = {
    'min': 0,
    'max': 23,
    'palette': palette_0_23
};

var RGB = {bands: ['R', 'N', 'B'], gain: [0.2, 0.06, 0.2]}; // ANDES
// var RGB = {bands: ['R', 'G', 'B'], min:630, max:2950}; //COSTA

var region = ee.FeatureCollection(regionesclass)
                .filterMetadata("Codigo_uni","equals", param.code_region);
var regionRaster = ee.Image(AssetRegionsRaster).eq(param.code_region).selfMask()

var lim_ANP = ee.FeatureCollection("projects/ee-eturpocayo/assets/sernanp/AUXILIAR_DATA/limite_anp_v2")
                      .filter(ee.Filter.eq('Codigo_uni', param.code_region));
var lim_ANP_raster = ee.Image('projects/ee-anp-lineabase/assets/AUXILIAR-DATA/limite_anp_v2_raster').eq(param.code_region).selfMask();

var anp_za = regionRaster.where(lim_ANP_raster,2) // ANP:2 ZA:1

// Map.addLayer(anp_za.randomVisualizer())

Map.addLayer(region.style({color:'black', fillColor:'00000000'}),{},'region')
// Map.centerObject(region)

var altitud = ee.Image("USGS/SRTMGL1_003");
// var slope = ee.Terrain.slope(altitud).int8()
//     .rename('slope');

var FABDEM = ee.ImageCollection("projects/sat-io/open-datasets/FABDEM");
var proj_FABDEM = FABDEM.first().select(0).projection();//.aside(print);
var slope = ee.Terrain.slope(FABDEM.mosaic()
                             .setDefaultProjection(proj_FABDEM))
                             .rename('slope');
var hand90_1000 = ee.Image("users/gena/GlobalHAND/90m-global/hand-1000")


Map.addLayer(slope,{},'slope',false);
Map.addLayer(altitud,{},'altitud',false);
Map.addLayer(hand90_1000,{},'hand90_1000',false);


var Mapbiomas = ee.Image('projects/mapbiomas-public/assets/peru/collection2/mapbiomas_peru_collection2_integration_v1')
                  .select('classification_2021');

var mosaic = ee.ImageCollection('projects/ee-anp-lineabase/assets/mosaics')
                    .filterBounds(region.geometry().bounds())
                    .map(function(image){
                        var Mapbiomas = ee.Image('projects/mapbiomas-public/assets/peru/collection2/mapbiomas_peru_collection2_integration_v1')
                                          .select('classification_2021')
                        image = image.updateMask(image.select('B').lte(cloud_Blue_thr).or(Mapbiomas.eq(34).unmask(regionRaster)))
                        
                        var ndvi = image.normalizedDifference(['N', 'R']).rename('NDVI');
                        var ndwi = image.normalizedDifference(['G', 'N']).rename('NDWI');
                        
                        return image.addBands(ndvi)
                                    .addBands(ndwi)
                                    
                    })
                    
var image_FE = ee.ImageCollection(assetFiltros)
               .filterMetadata('code_region', 'equals', param.code_region)
               .filterMetadata('version', 'equals', version_input)
               .first()

print(image_FE);

var Last_version = ee.ImageCollection(assetFiltros)
               .filterMetadata('code_region', 'equals', param.code_region)
               .filterMetadata('version', 'equals', '15')
               .first()

print(Last_version);

                        
//-----
var years = [
    1,2,3,
    4,5,6,
    7,8,9,
    10,11,12
    ];

// get band names list 
var bandNames = ee.List(
    years.map(
        function (year) {
            return 'clasificacion_' + String(year);
        }
    )
);

// generate a histogram dictionary of [bandNames, image.bandNames()]
var bandsOccurrence = ee.Dictionary(
    bandNames.cat(image_FE.bandNames()).reduce(ee.Reducer.frequencyHistogram())
);

// print(bandsOccurrence);

// insert a masked band 
var bandsDictionary = bandsOccurrence.map(
    function (key, value) {
        return ee.Image(
            ee.Algorithms.If(
                ee.Number(value).eq(2),
                image_FE.select([key]).byte(),
                ee.Image().rename([key]).byte().updateMask(image_FE.select(0))
            )
        );
    }
);
// convert dictionary to image
var imageAllBands = ee.Image(
    bandNames.iterate(
        function (band, image) {
            return ee.Image(image).addBands(bandsDictionary.get(ee.String(band)));
        },
        ee.Image().select()
    )
);

image_FE = imageAllBands
// var filtered = image_FE;
var filtered = Last_version.where(image_FE.eq(3),3)
                            .where(image_FE.eq(8),8)
                            .where(image_FE.eq(10),10)
                            .where(image_FE.eq(11),11)
                            .where(image_FE.eq(15),15);

/**
 * Función para remapear, de manera interactiva, zonas delimitadas por polígonos
 * Estos polígonos se dibujan con las herramientas de dibujo de GEE
 * y se definen como ee.FeatureCollection()
 */
function remapWithPolygons(imageYear, polygons, years) {
  
  if(polygons.length > 0) {  
    polygons.forEach(function( polygon ) {
      var excluded = polygon.map(function( layer ){
        
        var area = imageYear.clip(layer);
        var from = ee.String(layer.get('original')).split(',');
        var to = ee.String(layer.get('new')).split(',');
        
        var t0 = ee.Number.parse(layer.get('t0'));
        var t1 = ee.Number.parse(layer.get('t1'));
        var yearsSel = ee.List.sequence(t0,t1,1)

        from = from.map( function( item ){
          return ee.Number.parse( item );
        });
        to = to.map(function(item){
          return ee.Number.parse( item );
        });
        
        var remapRY = area;

        var imageOperation = function(year, previousImage) {
          var remapYear = area.select(ee.String('clasificacion_').cat(ee.Number(year).toInt16()))
                              .remap(from, to)
                              .rename(ee.String('clasificacion_').cat(ee.Number(year).toInt16()));
          
          return ee.Image(previousImage).addBands(remapYear, null, true);
        };
        
        remapRY = ee.Image(yearsSel.iterate(imageOperation, remapRY));
        
        return remapRY;
      });
      print('excluded',excluded);
      excluded = ee.ImageCollection( excluded ).mosaic();
      // Map.addLayer(excluded);
      
      imageYear = excluded.unmask( imageYear );
      imageYear = imageYear.mask( imageYear.neq(17) );
    });
  } else imageYear = imageYear;
  
  return imageYear;
  
}


 
// Exclusión de clases en areas delimitadas con geometrías
  var polygons = param.remapGeometry;
  filtered = remapWithPolygons(filtered, polygons, years);



filtered =filtered.select(bandNames)
                    .updateMask(regionRaster);

//----

// Geometrias_colectadas_assets
  var folder = 'projects/ee-anp-lineabase/assets/AUXILIAR-DATA/geometry';
  var list = ee.List([]);
  
  function list_folder_to_featColl(e) {
    var path = e.id;
    var fc = ee.FeatureCollection(path)
              // .aggregate_sum('system:asset_size')
              // .divide(ee.Number(1024).pow(4))
    return fc; 
  }
  
  // Function to recursively concatenate asset lists from multiple pages
  function listAssetsRecursive(folder, pageToken) {
    var options = {};
    if (pageToken !== undefined) {
      options.pageToken = pageToken;
    }
  
    var result = ee.data.listAssets(folder, options);
    var assets = result['assets'];
    list = list.cat(assets.map(list_folder_to_featColl));
  
    if (result.nextPageToken !== null) {
      // Call the function recursively for the next page
      listAssetsRecursive(folder, result.nextPageToken);
    }
  }
  
  // Start listing assets
  listAssetsRecursive(folder);
  
  // Print the final concatenated asset list
  // print('Final Asset List:', list);
  
  var geometry_draw = ee.FeatureCollection(list).flatten();
  
  // print(geometry_draw)
  
  // Create buffer 4 m
  var geometry_draw_buf = geometry_draw.map(function(fea){
    return fea.buffer(4)
  })
  
// GEOMETRIAS CLASE COLL
  var Samples_Collect_raster = geometry_draw_buf
                              .reduceToImage(['clase'], ee.Reducer.first())
                              .updateMask(regionRaster)
                              .rename('clase');
  Map.addLayer(Samples_Collect_raster, {min: 0, max: 20, palette: palette_0_23}, 'Samples_Collect_raster',false);
  
  var masks_class = regionRaster.multiply(0).add(99).where(Samples_Collect_raster.eq(1),1)
                                                            .where(Samples_Collect_raster.eq(2),2)
                                                            // .where(Mapbiomas.eq(4),4)
                                                            .rename('mask')
                                                            
  var agricultur_fre = filtered.eq(3).or(filtered.eq(12)).reduce('sum').gte(11)
              
                                                            
  filtered = filtered//.where(filtered.eq(2).and(masks_class.neq(2)),10)
                     .where(filtered.eq(1).and(masks_class.neq(1)),10)
                    // .where(filtered.eq(11).and(masks_class.eq(1)),1)
                    // .where(filtered.eq(10).and(masks_class.eq(1)),1)
                    .where(filtered.eq(3),22) // solo titicaca
                    .where(Samples_Collect_raster.eq(1),1)
                    // .where(Samples_Collect_raster.eq(5),5)
                    // .where(Samples_Collect_raster.eq(15),15)
                    .where(Samples_Collect_raster.eq(2),2)
                    .where(Samples_Collect_raster.eq(10),10)
                    .where(agricultur_fre.eq(1).and(anp_za.eq(2)),12) // solo titicaca
                    .where(agricultur_fre.eq(1).and(anp_za.eq(1)),23) // solo titicaca
                    
                    // .where(filtered.eq(15).and(slope.gte(5).and(hand90_1000.gte(1000))),10)
                    // .where(filtered.eq(15).and(slope.gte(10).and(hand90_1000.gte(500))),10)
                    // .where(filtered.eq(15).and(slope.gte(15).and(hand90_1000.gte(30))),10)
                    // .where(filtered.eq(15).and(slope.gte(30).and(hand90_1000.lte(30))),10)
                    // .where(filtered.eq(12).and(altitud.lte(3110)),8)
                    // .where(filtered.eq(14).and(altitud.lte(4000)),10)
  



for (var mesI=0;mesI<param.mes.length;mesI++) {
  
  var vis = {
      'bands': 'clasificacion_'+param.mes[mesI],
      'min': 0,
      'max': 23,
      'palette': palette_0_23
  };
  Map.addLayer(mosaic.filter(ee.Filter.eq('month', param.mes[mesI])).mosaic().updateMask(regionRaster), RGB, 'mosaic-'+param.mes[mesI], false);
  
    
  Map.addLayer(image_FE, vis, 'original'+param.mes[mesI],false);
  
  Map.addLayer(Last_version, vis, 'Last_version'+param.mes[mesI],false);
  
  Map.addLayer(filtered, vis, 'filtered'+param.mes[mesI],false);
}
Map.addLayer(agricultur_fre.selfMask(),{palette:'red'})


Map.addLayer(Last_version.reduce('mode'), {
    'min': 0,
    'max': 23,
    'palette': palette_0_23
}, 'mode_14',false);

Map.addLayer(image_FE.reduce('mode'), {
    'min': 0,
    'max': 23,
    'palette': palette_0_23
}, 'mode_25',false);


Map.addLayer(filtered.reduce('mode'), {
    'min': 0,
    'max': 23,
    'palette': palette_0_23
}, 'mode_ft',true);


Map.addLayer(filtered.eq(15).reduce('max').selfMask(), {
    'palette': 'blue'
}, 'water_max',false);

Map.addLayer(filtered.eq(1).reduce('max').selfMask(), {
    'palette': 'red'
}, 'urban_max',false);

Map.addLayer(filtered.eq(3).reduce('max').selfMask(), {
    'palette': '#b40b0b'
}, 'c3_max',false);

Map.addLayer(filtered.eq(12).reduce('max').selfMask(), {
    'palette': '#b40b0b'
}, 'c12_max',false);

Map.addLayer(filtered.eq(15).reduce('max').selfMask(), {
    'palette': '#b40b0b'
}, 'c15_max',false);


Map.addLayer(filtered.eq(10).reduce('max').selfMask(), {
    'palette': '#b40b0b'
}, 'c10_max',false);


filtered = filtered
          .set('code_region', param.code_region)
          .set('version', version_output)
          .set('descripcion', 'filtro reclas')

print(filtered)
          
// EXPORTS 
  Export.image.toAsset({
      'image': filtered,
      'description': prefixo_out+version_output,
      'assetId': dirout+'/' +prefixo_out+version_output,
      'pyramidingPolicy': {
          '.default': 'mode'
      },
      'region': region.geometry().bounds(),
      'scale': 4.7,
      'maxPixels': 1e13
  });
  




// Mapas referencia remap

    // Mapeo de clases Mapbiomas
    //   3: 'Bosque',
    //   4: 'Bosque seco',
    //   5: 'Manglar',
    //   6: 'Bosque inundable',
    //   9: 'Plantación forestal',
    //   11: 'Zona pantanosa o pastizal inundable',
    //   12: 'Pastizal / herbazal',
    //   13: 'Matorral y otras formaciones no boscosas',
    //   15: 'Pasto',
    //   18: 'Agricultura',
    //   21: 'Mosaico agropecuario',
    //   24: 'Infraestructura',
    //   25: 'Otra área sin vegetación',
    //   27: 'No observado',
    //   30: 'Minería',
    //   31: 'Acuicultura',
    //   32: 'Salina',
    //   33: 'Río, lago u océano',
    //   34: 'Glaciar',
    //   35: 'Palma aceitera'
      
  var remap_MB = {
      from: [3, 4, 5, 6, 9, 11, 12, 13, 15, 18, 21, 24, 25, 30, 31, 32, 33, 34],
      to:   [5, 4, 6, 5, 7, 12,  8,  9,  8,  3,  3,  1, 10,  2, 15, 10, 15, 14]
    }

  // Mapeo de clases WorldCover
  //   10: 'Bosque',
  //   20: 'Matorrales',
  //   30: 'Pastizales',
  //   40: 'Tierras de cultivo',
  //   50: 'Construcciones',
  //   60: 'Escasa vegetación',
  //   70: 'Nieve y hielo',
  //   80: 'Cuerpos de agua permanentes',
  //   90: 'Humedales herbáceos',
  //   95: 'Manglares',
  //   100: 'Musgo y líquenes'

  var remap_WC = {
      from: [10, 20, 30, 40, 50, 60, 70, 80, 90, 95, 100],
      to:   [ 7,  9,  8,  3,  1, 10, 14, 15, 12,  6,  17]
    }
    
  var Mapbiomas = ee.Image('projects/mapbiomas-public/assets/peru/collection2/mapbiomas_peru_collection2_integration_v1')
                    .select('classification_2021')
                    .remap(remap_MB.from, remap_MB.to)
                    .updateMask(regionRaster);
                    
  var WorldCover = ee.ImageCollection('ESA/WorldCover/v200').first()
                    .remap(remap_WC.from, remap_WC.to)
                    .updateMask(regionRaster);
  
// var updtReference = ee.Image(WorldCover.updateMask(Mapbiomas.eq(WorldCover))).updateMask(regionRaster)
  
Map.addLayer(Mapbiomas.selfMask(),{min: 0, max: 20, palette: palette_0_23},'Mapbiomas', false)
Map.addLayer(WorldCover.selfMask(),{min: 0, max: 20, palette: palette_0_23},'WorldCover', false)

var tillandsia = ee.Image('users/gistin/fog_oasis/tillandsia')
Map.addLayer(tillandsia,{palette:'#b30adb'},'tillandsia', false)

var fo_class2021 = ee.Image('users/gistin/fog_oasis/fo_class2021')
Map.addLayer(fo_class2021,{"min":1,"max":6,"palette":["ff0000","ffa906","ffee06","89ff0c","27ff02","30df2f"]},'fo_class2021', false)




function Legend() {
  
  var legendColors = [
          {color: palette_0_23[1], label:'c1_area_urbana y carret'},
          {color: palette_0_23[2], label:'c2_mineria'},
          {color: palette_0_23[3], label:'c3_agricultura'},
          {color: palette_0_23[4], label:'c4_bosque_seco'},
          {color: palette_0_23[5], label:'c5_bosque'},
          {color: palette_0_23[6], label:'c6_manglar'},
          {color: palette_0_23[7], label:'c7_bosque_plantado'},
          {color: palette_0_23[8], label:'c8_pastizales'},
          {color: palette_0_23[9], label:'c9_arbustal_matorral'},
          {color: palette_0_23[10], label:'c10_poca_vegetacion'},
          {color: palette_0_23[11], label:'c11_totoral'},
          {color: palette_0_23[12], label:'c12_bofedal'},
          {color: palette_0_23[13], label:'c13_areas_humedas_costeras'},
          {color: palette_0_23[14], label:'c14_glaciar'},
          {color: palette_0_23[15], label:'c15_Agua'},
          {color: palette_0_23[16], label:'c16_aguas_maritima'},
          {color: palette_0_23[17], label:'c17_sin_dato'},
          {color: palette_0_23[18], label:'c18_Acuicultura'},
          {color: palette_0_23[19], label:'c19_Hipersalina'},
          {color: palette_0_23[20], label:'c20_Banco_arena'},
          {color: palette_0_23[21], label:'c21_Tillandsial'},
          {color: palette_0_23[22], label:'c22_Cultivos transitorios'},
          {color: palette_0_23[23], label:'c23_Cultivos permanentes'}
  ];

  // Crear un panel para la leyenda
  var legendPanel = ui.Panel({
    style: {
      position: 'bottom-left',
      padding: '8px 15px'
    }
  });

  // Crear un título para la leyenda
  var legendTitle = ui.Label({
    value: 'Leyenda general',
    style: {fontWeight: 'bold', fontSize: '16px', margin: '0 0 4px 0'}
  });

  legendPanel.add(legendTitle);

  // Crear un panel de cuadrícula para organizar en columnas
  var gridPanel = ui.Panel({
    layout: ui.Panel.Layout.Flow('horizontal'),
    style: {stretch: 'horizontal'}
  });

  // Número de columnas deseadas
  var columns = 2;

  // Crear un array de columnas como paneles
  var columnPanels = [];
  for (var i = 0; i < columns; i++) {
    columnPanels.push(ui.Panel({
      layout: ui.Panel.Layout.Flow('vertical'),
      style: {padding: '0 10px'}
    }));
  }

  // Añadir elementos a las columnas alternando entre ellas
  legendColors.forEach(function(item, index) {
    var colorBox = ui.Label('', {
      backgroundColor: item.color,
      padding: '6px',
      margin: '0 0 4px 0'
    });

    var description = ui.Label(item.label, {
      margin: '0 0 4px 6px'
    });

    var legendItem = ui.Panel({
      widgets: [colorBox, description],
      layout: ui.Panel.Layout.Flow('horizontal')
    });

    // Añadir a la columna correspondiente
    columnPanels[index % columns].add(legendItem);
  });

  // Añadir todas las columnas al panel de cuadrícula
  columnPanels.forEach(function(panel) {
    gridPanel.add(panel);
  });

  // Añadir el panel de cuadrícula a la leyenda
  legendPanel.add(gridPanel);

  return legendPanel;
}

var legend_MB = Legend();
Map.add(legend_MB);  // Añadir la leyenda al mapa

Map.addLayer(lim_ANP.style({color: 'black', fillColor:'00000000'}), {},'anp',false)

 